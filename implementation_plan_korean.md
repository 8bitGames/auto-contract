# 계약서 AI 부분 수정 및 신규 생성 기능 구현 계획 (최종안)

## 1. 요구사항 재정의 (Refined Understanding)

사용자분의 피드백을 반영하여 요구사항을 확장했습니다:
1.  **기본 방식 (Template Mode)**: 기존 입력 폼 방식을 유지하되, 각 조항(Section)별로 AI 부분 수정이 가능해야 합니다.
2.  **신규 생성 (New Contract Mode)**: 템플릿 없이, 사용자의 요청(예: "프리랜서 디자인 계약서 만들어줘")만으로 **완전히 새로운 계약서**를 생성할 수 있어야 합니다.
3.  **프롬프트 설계**: 신규 계약서 생성을 위한 AI 프롬프트가 미리 정의되어야 합니다.

---

## 2. 기술적 접근 (Technical Approach)

### A. 데이터 구조의 유연화 (Common Structure)
"템플릿 계약서"와 "신규 생성 계약서" 모두 동일한 데이터 구조를 사용합니다.

*   **공통 구조 (`ContractData`)**:
    ```typescript
    interface ContractSection {
      id: string;
      title: string; // 예: "제1조 목적"
      content: string; // 예: "본 계약은..."
    }
    
    interface ContractData {
      title: string; // 계약서 제목
      sections: ContractSection[]; // 모든 조항은 섹션 리스트로 관리
      variables: Record<string, string>; // (선택사항) 템플릿 변수들
    }
    ```

### B. 신규 계약서 생성 프로세스
1.  **진입**: "새 계약서 만들기" -> "AI로 새로 만들기" 선택
2.  **입력**: 사용자가 계약의 종류와 핵심 내용을 입력 (예: "유튜브 편집자 계약서이고, 건당 10만원, 수정은 2회 제한으로 해줘")
3.  **생성**: AI가 입력 내용을 바탕으로 `title`과 `sections` 배열을 JSON 형태로 생성하여 반환
4.  **편집**: 생성된 결과가 뷰어에 표시되고, 이후부터는 "부분 수정" 기능을 통해 다듬기 가능

---

## 3. 프롬프트 설계 (Prompt Engineering)

사용자 요청 시 **"완전히 새로운 계약서"**를 만들기 위한 시스템 프롬프트입니다.

### [System Prompt: Create New Contract]
```text
당신은 대한민국 법률에 정통한 전문 변호사 AI입니다.
사용자의 요구사항을 바탕으로 법적 효력이 있는 계약서 초안을 작성해야 합니다.

[지시사항]
1. 사용자의 요청을 분석하여 적절한 계약서 제목을 정하세요.
2. 계약서에 반드시 포함되어야 할 필수 조항들을 구성하세요.
3. 각 조항은 'title'(조항 제목)과 'content'(조항 내용)으로 분리하세요.
4. 내용은 명확하고 전문적인 법률 용어를 사용하되, 이해하기 쉬워야 합니다.
5. 결과는 반드시 아래의 JSON 포맷으로만 출력하세요. (Markdown 코드 블럭 없이 순수 JSON만 반환)

[JSON 포맷]
{
  "title": "계약서 제목 (예: 프리랜서 용역 계약서)",
  "sections": [
    {
      "id": "section_1",
      "title": "제1조 (목적)",
      "content": "본 계약은 '갑'이 '을'에게..."
    },
    {
      "id": "section_2",
      "title": "제2조 (업무의 범위)",
      "content": "..."
    }
    // ... 필요한 만큼 섹션 추가
  ]
}
```

---

## 4. 단계별 구현 계획

### 1단계: 데이터 구조 리팩토링
*   [ ] `useContractStore` 개선: `sections` 기반으로 상태 관리 구조 변경
*   [ ] `LaborContract.tsx`를 `DynamicContract.tsx`로 변경 (또는 신규 생성): `sections` 배열을 렌더링하는 범용 컴포넌트 구현

### 2단계: AI 부분 수정 기능 (Partial Edit)
*   [ ] 각 섹션별 "AI 수정" 버튼 및 모달 구현
*   [ ] 부분 수정용 프롬프트 및 API 연동

### 3단계: AI 신규 생성 기능 (Create New)
*   [ ] 대시보드에 "AI로 새 계약서 만들기" 버튼 추가
*   [ ] 요구사항 입력 모달 구현
*   [ ] **위에서 설계한 프롬프트**를 사용하여 OpenAI API 연동 및 응답 파싱 로직 구현

---

## 5. 사용자 확인

이제 **기존 템플릿 활용**과 **완전 신규 생성**이 모두 가능한 구조가 되었습니다.
특히 요청하신 **"신규 생성 프롬프트"**도 설계에 포함시켰습니다.
이대로 구현을 시작해도 될까요?
